
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ЗаполнитьЗначенияСвойств(ЭтаФорма, Запись.НастройкаМаппинга);
	ЗаполнитьЗначенияСвойств(ЭтаФорма, Запись.НастройкаМаппинга.ПравилоМаппинга);
	СтрокаПодключенияИсточник = NSI_ОбщиеПроцедуры.ПолучитьСтрокуПодключения(БазаИсточник);
	СтрокаПодключенияПриемник = NSI_ОбщиеПроцедуры.ПолучитьСтрокуПодключения(БазаПриемник);
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеИсточникаНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	КОМ = NSI_ОбщиеПроцедурыКлиент.ПолучитьСоединениеСБД(?(Элемент.Имя="ПредставлениеИсточника", СтрокаПодключенияИсточник, СтрокаПодключенияПриемник));
	ТипОбъекта = ?(Элемент.Имя="ПредставлениеИсточника", ТипОбъектаИсточника, ТипОбъектаПриемника);
	ТипОбъекта = СтрЗаменить(ТипОбъекта, "Справочники", "Справочник");
	ТипОбъекта = СтрЗаменить(ТипОбъекта, "Документы", "Документ");
	СтруктураПараметров = КОМ.NewObject("Структура");
	Если ЗначениеЗаполнено(?(Элемент.Имя="ПредставлениеИсточника", Запись.ИДИсточника, Запись.ИДПриемника)) Тогда
		СсылкаНаСтароеЗначение = КОМ.NSI.ПолучитьСсылкуПоМенеджеруИИД(?(Элемент.Имя="ПредставлениеИсточника", ТипОбъектаИсточника, ТипОбъектаПриемника), ?(Элемент.Имя="ПредставлениеИсточника", Запись.ИДИсточника, Запись.ИДПриемника));
		СтруктураПараметров.Вставить("ТекущаяСтрока", СсылкаНаСтароеЗначение);
	КонецЕсли;
	Объект = КОМ.ОткрытьФормуМодально(ТипОбъекта+".ФормаВыбора", СтруктураПараметров);
	Если Элемент.Имя = "ПредставлениеИсточника" Тогда
		Если Не Объект=Неопределено Тогда
			Запись.ПредставлениеИсточника = КОМ.String(Объект);
			Запись.ИДИсточника = КОМ.String(Объект.УникальныйИдентификатор());
		КонецЕсли;
	Иначе
		Если Не Объект=Неопределено Тогда
			Запись.ПредставлениеПриемника = КОМ.String(Объект);
			Запись.ИДПриемника = КОМ.String(Объект.УникальныйИдентификатор());
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеИсточникаОчистка(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	Запись.ПредставлениеИсточника = "";
	Запись.ИДИсточника = "";
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеПриемникаОчистка(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	Запись.ПредставлениеПриемника = "";
	Запись.ИДПриемника = "";
КонецПроцедуры
