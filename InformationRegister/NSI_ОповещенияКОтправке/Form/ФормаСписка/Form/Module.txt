
&НаКлиенте
Процедура ОтправкаПисьма(Команда)
	ОтправитьПисьмо(Элементы.Список.ТекущаяСтрока);
КонецПроцедуры

&НаСервере
Процедура ОтправитьПисьмо(КлючСообщенияКОтправке)
	Менеджер = РегистрыСведений.NSI_ОповещенияКОтправке.СоздатьМенеджерЗаписи();	
	ЗаполнитьЗначенияСвойств(Менеджер, КлючСообщенияКОтправке);
	Менеджер.Прочитать();
		
	ПараметрыПисьма = Новый Структура;
	
	Если ЗначениеЗаполнено(Менеджер.Адрес) Тогда
		ПараметрыПисьма.Вставить("Кому", Менеджер.Адрес);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Менеджер.АдресОтвета) Тогда
		ПараметрыПисьма.Вставить("АдресОтвета", Менеджер.АдресОтвета);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Менеджер.ТемаСообщения) Тогда
		ПараметрыПисьма.Вставить("Тема", Менеджер.ТемаСообщения);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Менеджер.ТелоСообщения) Тогда
		ПараметрыПисьма.Вставить("Тело", Менеджер.ТелоСообщения);
	КонецЕсли;
	
	//ВложенияВПисьмо = Менеджер.Вложения.Получить();;
	//Если ТипЗнч(ВложенияВПисьмо) = Тип("Массив") И ВложенияВПисьмо.Количество() > 0 Тогда
	//	Вложения = Новый Соответствие;
	//	Для Каждого ЭлементВложение Из ВложенияВПисьмо Цикл
	//		Если ЭлементВложение.Пометка Тогда
	//			ДвоичныеДанные = Новый ДвоичныеДанные(ЭлементВложение.Значение);
	//			Вложения.Вставить(ЭлементВложение.Представление, ДвоичныеДанные);
	//		Иначе
	//			Вложения.Вставить(ЭлементВложение.Представление, ЭлементВложение.Значение);
	//		КонецЕсли;
	//	КонецЦикла;
	//	ПараметрыПисьма.Вставить("Вложения", Вложения);
	//КонецЕсли;
	
	//ЭлектроннаяПочта.ОтправитьПочтовоеСообщение(ЭлектроннаяПочта.ПолучитьСистемнуюУчетнуюЗапись(), ПараметрыПисьма);
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьПисьма(Команда)
	NSI_РаботаСОповещениями.ОтправкаОповещений();
КонецПроцедуры
