&НаСервере
Функция ПолучитьСоединениеСПроверочнойБазой(ИмяХранилища)
	Connector = Неопределено;
	ЗапросБазы = Новый Запрос("ВЫБРАТЬ
	                          |	СписокИБ.СтрокаПодключения,
	                          |	СписокИБ.АдресВебСервера,
	                          |	СписокИБ.ПользовательВебСервиса,
	                          |	СписокИБ.ПарольВебСервиса
	                          |ИЗ
	                          |	Справочник.NSI_СписокВИБ КАК СписокИБ
	                          |ГДЕ
	                          |	НЕ СписокИБ.ПометкаУдаления
	                          |	И СписокИБ.Проверочная
	                          |	И СписокИБ.ИмяХранилища = &ИмяХранилища");
	ЗапросБазы.УстановитьПараметр("ИмяХранилища", ИмяХранилища);
	Выборка = ЗапросБазы.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		Если Не ЗначениеЗаполнено(Выборка.АдресВебСервера) Тогда			
			Connector = Новый COMОбъект("v83.ComConnector");
			Попытка
				Connector.Connect(Выборка.СтрокаПодключения);
				Возврат Connector;
			Исключение
				Возврат Неопределено;
			КонецПопытки
		Иначе
			Определение = Новый WSОпределения(Выборка.АдресВебСервера, Выборка.ПользовательВебСервиса, Выборка.ПарольВебСервиса);
			Прокси = Новый WSПрокси(Определение, "nsi", "NSI_Core", "NSI_CoreSoap");
			Прокси.Пользователь = Выборка.ПользовательВебСервиса;
			Прокси.Пароль = Выборка.ПарольВебСервиса;
			Возврат Прокси;
		КонецЕсли;
	Иначе
		
		Возврат Неопределено;
	КонецЕсли;
КонецФункции

