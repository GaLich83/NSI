Перем СоответствиеПолей Экспорт;
Перем ОписаниеПолей Экспорт;
Перем ПроверкаГруппы;

Процедура ПриЗаписи(Отказ)
	NSI_РаботаСМастерДаннымиСервер.ОбновитьЗначенияПолейИИндексыПослеЗаписи(Ссылка, ОписаниеПолей, СоответствиеПолей);
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	Наименование = NSI_РаботаСМастерДаннымиСервер.ПолучитьПредставлениеКлюча(ОписаниеПолей, СоответствиеПолей);
КонецПроцедуры

Функция ДополнитьСтруктуруИзмененийВычисляемымиРеквизитами() Экспорт
	ТаблицаДопРеквизитов = NSI_Логирование.СоздатьПустуюТаблицуРеквизитов();
	Для Каждого СтрокаПоля Из ОписаниеПолей Цикл
		ЗначениеПоля = Неопределено;
		СтрокаДопРеквизита = ТаблицаДопРеквизитов.Добавить();
		СтрокаДопРеквизита.Имя = СтрокаПоля.ИмяПоля;
		СтрокаДопРеквизита.Синоним = СтрокаПоля.СинонимПоля;
		СоответствиеПолей.Свойство(СтрокаПоля.ИмяПоля, СтрокаДопРеквизита.Значение)
	КонецЦикла;
	Возврат ТаблицаДопРеквизитов;
КонецФункции

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, ТекстЗаполнения, СтандартнаяОбработка)
	Если ЗначениеЗаполнено(ДанныеЗаполнения) Тогда
		Если ТипЗнч(ДанныеЗаполнения)=Тип("Структура") Тогда
			Если ЗначениеЗаполнено(ДанныеЗаполнения.Владелец) Тогда
				ОписаниеПолей = NSI_РаботаСМастерДаннымиСерверПовторноеИспользование.ПолучитьОписаниеПолей(Ссылка.Владелец, ЭтоГруппа);					
				СоответствиеПолей = NSI_РаботаСМастерДаннымиСервер.ПолучитьТекущиеЗначенияПолей(Ссылка);				
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	ОписаниеПолей = NSI_РаботаСМастерДаннымиСерверПовторноеИспользование.ПолучитьОписаниеПолей(ОбъектКопирования.Владелец, ОбъектКопирования.ЭтоГруппа);					
	СоответствиеПолей = NSI_РаботаСМастерДаннымиСервер.ПолучитьТекущиеЗначенияПолей(ОбъектКопирования);
КонецПроцедуры




// Инициализация экспортных переменных объекта
ПроверкаГруппы = Ложь;
Если NSI_РаботаСМастерДаннымиПоиск.ВернутьСуществующуюСсылку(XMLСтрока(Ссылка), Тип("СправочникСсылка.NSI_МастерДанные"))=Неопределено Тогда
	ПроверкаГруппы = Ссылка.ЭтоГруппа;
Иначе
	ПроверкаГруппы = ЭтоГруппа;
КонецЕсли;
ОписаниеПолей = NSI_РаботаСМастерДаннымиСерверПовторноеИспользование.ПолучитьОписаниеПолей(Ссылка.Владелец, ПроверкаГруппы);
СоответствиеПолей = NSI_РаботаСМастерДаннымиСервер.ПолучитьТекущиеЗначенияПолей(Ссылка);





