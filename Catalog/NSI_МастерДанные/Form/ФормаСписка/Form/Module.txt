
&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	Отказ = Истина;
	//Если Копирование Тогда
	//	Сообщить("Копирование элементов мастер-данных не предусмотрено");
	//	Возврат;
	//КонецЕсли;
	СтрокиСоответствия = ТаблицаСоответствияСтраницВидамМД.НайтиСтроки(Новый Структура("ИмяСтраницы", Элементы.СписокВидовМастерДанных.ТекущаяСтраница.Имя));
	Владелец = СтрокиСоответствия[0].ВидМД;
	Если Элементы.Список.ТекущиеДанные=Неопределено Тогда		
		РодительЭлемента = Неопределено;
	Иначе
		РодительЭлемента = Элементы.Список.ТекущиеДанные.Родитель;
	КонецЕсли;
	Если Копирование Тогда
		СтруктураЗаполнения = ПолучитьСтруктуруПолейКопируемогоЭлемента(Элементы.Список.ТекущиеДанные.Ссылка)
	КонецЕсли;
	Если Группа Тогда
		ОткрытьФорму("Справочник.NSI_МастерДанные.ФормаОбъекта", Новый Структура("ЗначенияЗаполнения, ЭтоГруппа", Новый Структура("Владелец, Родитель, СтруктураЗаполнения",Владелец, РодительЭлемента, СтруктураЗаполнения), Группа));
	Иначе
		ОткрытьФорму("Справочник.NSI_МастерДанные.ФормаГруппы", Новый Структура("ЗначенияЗаполнения, ЭтоГруппа", Новый Структура("Владелец, Родитель, СтруктураЗаполнения", Владелец, РодительЭлемента, СтруктураЗаполнения), Группа));
	КонецЕсли;
КонецПроцедуры

&НаСервере
Функция ПолучитьСтруктуруПолейКопируемогоЭлемента(Ссылка)
	Об = Ссылка.ПолучитьОбъект();
	ОписаниеПолей = NSI_РаботаСМастерДаннымиСервер.ЗаписатьОбъектВXML(Об.ОписаниеПолей);
	СоответствиеПолей = NSI_РаботаСМастерДаннымиСервер.ЗаписатьОбъектВXML(Об.СоответствиеПолей);
	СтруктураОписаний = Новый Структура("ОписаниеПолей, СоответствиеПолей", ОписаниеПолей, СоответствиеПолей);
	Возврат СтруктураОписаний;
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ЗапросВидов = Новый Запрос("ВЫБРАТЬ РАЗРЕШЕННЫЕ
	                           |	NSI_ВидыМД.Ссылка
	                           |ИЗ
	                           |	Справочник.NSI_ВидыМД КАК NSI_ВидыМД
	                           |ГДЕ
	                           |	НЕ NSI_ВидыМД.ПометкаУдаления
	                           |
	                           |УПОРЯДОЧИТЬ ПО
	                           |	NSI_ВидыМД.ПорядокВыводаВидаМД");
	ВыборкаВидов = ЗапросВидов.Выполнить().Выбрать();
	НомерСтраницы = 1;
	Пока ВыборкаВидов.Следующий() Цикл
		ЭлементСтраница =Элементы.Добавить("СтраницаВидаМД"+Формат(НомерСтраницы, "ЧГ=0"), Тип("ГруппаФормы"), Элементы.СписокВидовМастерДанных);
	    ЭлементСтраница.Вид = ВидГруппыФормы.Страница;
	    ЭлементСтраница.Заголовок = ВыборкаВидов.Ссылка;
		ЭлементЗаголовок =Элементы.Добавить("ДекорацияВидаМД"+Формат(НомерСтраницы, "ЧГ=0"), Тип("ДекорацияФормы"), ЭлементСтраница);
		ЭлементЗаголовок.Вид = ВидДекорацииФормы.Надпись;
		ЭлементЗаголовок.Заголовок = ВыборкаВидов.Ссылка;
	    ЭлементСтраница.Вид = ВидГруппыФормы.Страница;
	    ЭлементСтраница.Заголовок = ВыборкаВидов.Ссылка;
		СтрокаСоответствия = ТаблицаСоответствияСтраницВидамМД.Добавить();
		СтрокаСоответствия.ИмяСтраницы = "СтраницаВидаМД"+Формат(НомерСтраницы, "ЧГ=0");
		СтрокаСоответствия.ВидМД = ВыборкаВидов.Ссылка;
		Если НомерСтраницы = 1 Тогда
//			Список.Параметры.УстановитьЗначениеПараметра("ВидМастерДанных", ВыборкаВидов.Ссылка);
			Параметры.Отбор.Вставить("Владелец", ВыборкаВидов.Ссылка);
			Элементы.СписокВидовМастерДанных.ТекущаяСтраница = ЭлементСтраница;	
			ПереместитьСписокНаТекущуюСтраницу();
		КонецЕсли;
		НомерСтраницы = НомерСтраницы + 1;
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура СписокВидовМастерДанныхПриСменеСтраницы(Элемент, ТекущаяСтраница)
	Если ТекущаяСтраница = Неопределено Тогда
		Возврат;
	КонецЕсли;
	СтрокиСоответствия = ТаблицаСоответствияСтраницВидамМД.НайтиСтроки(Новый Структура("ИмяСтраницы", ТекущаяСтраница.Имя));
	//Список.Параметры.УстановитьЗначениеПараметра("ВидМастерДанных", СтрокиСоответствия[0].ВидМД);
	ПолеВладельца = Новый ПолеКомпоновкиДанных("Владелец");
	Для Каждого СтрокаОтбора Из Список.Отбор.Элементы Цикл
		Если СтрокаОтбора.ЛевоеЗначение = ПолеВладельца Тогда
			СтрокаОтбора.ПравоеЗначение = СтрокиСоответствия[0].ВидМД;
		КонецЕсли;
	КонецЦикла;
	//Параметры.Отбор.Вставить("Владелец", СтрокиСоответствия[0].ВидМД);
	ПереместитьСписокНаТекущуюСтраницу();
КонецПроцедуры

&НаСервере
Процедура ПереместитьСписокНаТекущуюСтраницу()
	Элементы.Переместить(Элементы.Список, Элементы.СписокВидовМастерДанных.ТекущаяСтраница);
КонецПроцедуры



