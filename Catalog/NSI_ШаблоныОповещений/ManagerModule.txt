Функция ВычислениеЗначения(ТекстАлгоритма, СтруктураПараметров, Сообщать = Ложь, Вложения=Неопределено) Экспорт
	Если Вложения = Неопределено Тогда
		Вложения = Новый ТаблицаЗначений;
		Вложения.Колонки.Добавить("Ключ");
		Вложения.Колонки.Добавить("Значение");
	КонецЕсли;
	Результат = Неопределено;
	ТекстПараметров = "";
	Для Каждого Параметр Из СтруктураПараметров Цикл
		ТекстПараметров = ТекстПараметров + СоздатьСтроковоеВыражениеДляЗначения(Параметр.Ключ, Параметр.Значение)+";"+Символы.ПС;
	КонецЦикла;
	Выполнить(ТекстПараметров + ТекстАлгоритма);
	Если Сообщать Тогда
		ВывестиЗначение(Результат);
	КонецЕсли;
	Возврат Результат;
КонецФункции

Функция ВывестиЗначение(Значение)
	Если ТипЗнч(Значение) = Тип("Массив") Или ТипЗнч(Значение) = Тип("СписокЗначений") Тогда
		Ц = 0;
		Сообщить("  "+Значение+":");
		Для Каждого Строк Из Значение Цикл
			Сообщить("     "+Ц+": "+Строк);
			Ц = Ц+1;
		КонецЦикла;
	Иначе
		Сообщить("    "+Значение);
	КонецЕсли;
КонецФункции

Функция СоздатьСтроковоеВыражениеДляЗначения(Ключ = Неопределено, Значение)
	Если Справочники.ТипВсеСсылки().СодержитТип(ТипЗнч(Значение)) Тогда
		ИмяСправочника = Значение.Метаданные().Имя;
		Возврат ?(Ключ=Неопределено, "", Ключ+" = ")+"Справочники."+ИмяСправочника+".ПолучитьСсылку(Новый УникальныйИдентификатор("""+Значение.УникальныйИдентификатор()+"""))";
	ИначеЕсли ТипЗнч(Значение) = Тип("СписокЗначений") Тогда
		ТекстПеременной = Ключ + " = Новый СписокЗначений;"+Символы.ПС;
		Для Каждого ЭлементСписка Из Значение Цикл
			ТекстПеременной = ТекстПеременной + Ключ+".Добавить(" + СоздатьСтроковоеВыражениеДляЗначения(, ЭлементСписка.Значение)+");"+Символы.ПС;
		КонецЦикла;
		Возврат ТекстПеременной;
	ИначеЕсли Документы.ТипВсеСсылки().СодержитТип(ТипЗнч(Значение)) Тогда
		ИмяДокумента = Значение.Метаданные().Имя;
		Возврат ?(Ключ=Неопределено, "", Ключ+" = ")+"Документы."+ИмяДокумента+".ПолучитьСсылку(Новый УникальныйИдентификатор("""+Значение.УникальныйИдентификатор()+"""))";
	ИначеЕсли ТипЗнч(Значение) = Тип("Строка") Тогда
		Возврат ?(Ключ=Неопределено, "", Ключ+" = ")+""""+СтрЗаменить(Значение,"""","""""")+"""";
	Иначе
		Возврат ?(Ключ=Неопределено, "", Ключ+" = '")+Формат(Значение, "ЧН=; ЧГ=0; ДФ=yyyyMMddhhmmss; БЛ=Ложь; БИ=Истина")+"'";
	КонецЕсли;
КонецФункции
