Функция ПолучитьСоединениеПоИмениБазы(ИмяБазы) Экспорт
	Connector = Неопределено;
	База = ПолучитьСсылкуИБПоИмениБазы(ИмяБазы);
	Если ЗначениеЗаполнено(База) Тогда
		Если База.ВидБД = Перечисления.NSI_ВидыБД.Oracle Тогда
			СтрокаСоединения = "Provider=OraOLEDB.Oracle;Password="+База.Oracle_password+";User ID="+База.Oracle_user+";Data Source="+База.Oracle_schema+";Persist Security Info=False;";
			Попытка
				ТаблицаОбъектов = NSI_РаботаСАДО.ВыполнитьЗапрос(СтрокаСоединения, "select OBJECT_NAME, OBJECT_TYPE, TEMPORARY from user_objects where object_type in ('VIEW', 'TABLE', 'PACKAGE') and TEMPORARY='N'",,,Истина);
			Исключение
				ВызватьИсключение "Не удалось подключиться к базе Oracle: "+База.Oracle_schema;
			КонецПопытки;			
		ИначеЕсли Не ЗначениеЗаполнено(База.АдресВебСервера) Тогда
			Если База.ВерсияПлатформы = "8.3" Тогда
				Connector = Новый COMОбъект("v83.ComConnector");
			ИначеЕсли База.ВерсияПлатформы = "8.3" Тогда
				Connector = Новый COMОбъект("v82.ComConnector");
			ИначеЕсли База.ВерсияПлатформы = "8.1" Тогда
				Connector = Новый COMОбъект("v8.ComConnector");
			КонецЕсли;
			Попытка
				Connector.Connect(База.СтрокаПодключения);
				Возврат Connector;
			Исключение
				Возврат Неопределено;
			КонецПопытки
		Иначе
			Если ЗначениеЗаполнено(База.ИмяWSСсылки) Тогда
				Попытка
					Прокси = WSСсылки[База.ИмяWSСсылки].СоздатьWSПрокси("nsi", "NSI_Core", "NSI_CoreSoap12");
				Исключение
					Попытка
						Определение = Новый WSОпределения(База.АдресВебСервера, База.ПользовательВебСервиса, База.ПарольВебСервиса);
						Прокси = Новый WSПрокси(Определение, "nsi", "NSI_Core", "NSI_CoreSoap12");
					Исключение
						ВызватьИсключение "Не удалось создать прокси подключение к веб-сервису "+База.АдресВебСервера;
					КонецПопытки;
				КонецПопытки;
			Иначе
				Попытка
					Определение = Новый WSОпределения(База.АдресВебСервера, База.ПользовательВебСервиса, База.ПарольВебСервиса);
					Прокси = Новый WSПрокси(Определение, "nsi_core", "NSI_Core", "NSI_CoreSoap12");
				Исключение
					ВызватьИсключение "Не удалось создать прокси подключение к веб-сервису "+База.АдресВебСервера;
				КонецПопытки;
			КонецЕсли;
			Прокси.Пользователь = База.ПользовательВебСервиса;
			Прокси.Пароль = База.ПарольВебСервиса;
			Возврат Прокси;
		КонецЕсли;
	Иначе
		ВызватьИсключение "База с именем "+ИмяБазы+" не зарегистрирована в НСИ";
	КонецЕсли;
КонецФункции

Функция ПолучитьСсылкуИБПоИмениБазы(ИмяБазы) Экспорт
	ЗапросБазы = Новый Запрос("ВЫБРАТЬ ПЕРВЫЕ 1
	                          |	СписокИБ.Ссылка
							  |ИЗ
	                          |	Справочник.NSI_СписокВИБ КАК СписокИБ
	                          |ГДЕ
	                          |	(НЕ СписокИБ.ПометкаУдаления)
	                          |	И СписокИБ.ИмяБазы = &ИмяБазы");
	ЗапросБазы.УстановитьПараметр("ИмяБазы", ИмяБазы);
	Выборка = ЗапросБазы.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		Возврат Выборка.Ссылка;
	Иначе
		ВызватьИсключение "База с именем "+ИмяБазы+" не найдена в списке баз НСИ";
	КонецЕсли;
КонецФункции

Функция ПолучитьСтрокуПодключения(ИмяБазы) Экспорт
	ЗапросБазы = Новый Запрос("ВЫБРАТЬ
	                          |	СписокИБ.СтрокаПодключения,
	                          |	СписокИБ.АдресВебСервера
	                          |ИЗ
	                          |	Справочник.NSI_СписокВИБ КАК СписокИБ
	                          |ГДЕ
	                          |	(НЕ СписокИБ.ПометкаУдаления)
	                          |	И СписокИБ.ИмяБазы = &ИмяБазы");
	ЗапросБазы.УстановитьПараметр("ИмяБазы", ИмяБазы);
	Выборка = ЗапросБазы.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		Возврат Выборка.СтрокаПодключения;
	Иначе
		Возврат "";
	КонецЕсли;
КонецФункции

Функция ПолучитьСтруктуруПодключения(ИмяБазы) Экспорт
	ЗапросБазы = Новый Запрос("ВЫБРАТЬ
	                          |	СписокИБ.СтрокаПодключения,
	                          |	СписокИБ.ВерсияПлатформы
	                          |ИЗ
	                          |	Справочник.NSI_СписокВИБ КАК СписокИБ
	                          |ГДЕ
	                          |	НЕ СписокИБ.ПометкаУдаления
	                          |	И СписокИБ.ИмяБазы = &ИмяБазы");
	ЗапросБазы.УстановитьПараметр("ИмяБазы", ИмяБазы);
	Выборка = ЗапросБазы.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		Возврат Новый Структура("СтрокаПодключения, ВерсияПлатформы", Выборка.СтрокаПодключения, Выборка.ВерсияПлатформы);
	Иначе
		Возврат "";
	КонецЕсли;
КонецФункции

Функция ПолучитьСобытиеПоИмени(ИмяСобытия) Экспорт
	Событие = Справочники.NSI_СобытияОповещений.НайтиПоНаименованию(ИмяСобытия);
	Если ЗначениеЗаполнено(Событие) Тогда
		Возврат Событие;
	Иначе
		ВызватьИсключение "Имя события "+ИмяСобытия+" указано не правильно";
	КонецЕсли;
КонецФункции

Функция ПолучитьКэшируемоеСоединениеHTTP(Идентификатор) Экспорт
	Возврат Новый COMОбъект("MSXML2.XMLHTTP");
КонецФункции

Функция ПолучитьWSОпределение(ИмяОпределения) Экспорт
	Возврат Новый WSОпределения(ИмяОпределения);
КонецФункции

